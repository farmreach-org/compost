import{u as ie,B as v,H as A,af as X,l as Y,a4 as O,E as ce,n as ue,o as a,c as y,y as Z,e as g,g as M,J as de,h as f,A as B,m as z,N as F,k as V,a as d,ag as me,f as j,t as x,b as s,a3 as fe,w as o,F as P,C as Q,p as pe,O as ee,aw as te,j as se,i as ae}from"./app.17a8bbe4.js";import{n as ve}from"./index.browser.89e24408.js";import{_ as E}from"./Masonry.f60a1546.js";import{_ as L}from"./MediaFile.b8493171.js";import{S as ge}from"./SectionTitle.06d0ffc9.js";import{_ as le}from"./SearchInput.1ad6cb85.js";import{_ as ne}from"./NoResult.a422d351.js";import{_ as oe}from"./Alert.43894852.js";const R=(c="mixpost.media.fetchUploads",b={})=>{const{t:_}=ie(),{notify:D}=ue(),p=v("uploads"),C=A(()=>["uploads","stock","gifs"]),r=v(!1),w=v(!1),h=v(!1),k=v(1),m=v([]),$=v(null),S=v(""),i=v([]),N=t=>{const e=i.value.findIndex(l=>l.id===t.id);e<0&&!t.hasOwnProperty("error")&&i.value.push(t),e>=0&&i.value.splice(e,1)},u=()=>{i.value=[]},I=t=>i.value.findIndex(l=>l.id===t.id)!==-1,n=(t=!0)=>{!k.value||(O.start(),axios.get(route(c,b),{params:{page:k.value,keyword:S.value}}).then(function(e){const l=e.data.links.next;l&&(k.value=e.data.links.next.split("?page=")[1]),l||(k.value=0),t||(m.value=e.data.data),t&&(m.value=[...m.value,...e.data.data])}).catch(()=>{D("error",_("media.error_retrieving_media"))}).finally(()=>{O.done(),r.value=!0}))},U=(t,e)=>{w.value=!0,O.start(),axios.post(route("mixpost.media.download",b),{items:t,from:p.value}).then(l=>{e(l)}).catch(()=>{D("error",_("media.error_downloading_media"))}).finally(()=>{w.value=!1,O.done(),O.remove()})},H=t=>{m.value=m.value.filter(e=>!t.includes(e.id))},J=t=>{let e="";return t.forEach(l=>{l.source==="Unsplash"&&(e+=`
Photo by ${l.author} on Unsplash`)}),e},K=(t,e)=>{h.value=!0,O.start(),axios.delete(route("mixpost.media.delete",b),{data:{items:t}}).then(()=>{e()}).catch(()=>{D("error",_("media.error_deleting_media"))}).finally(()=>{h.value=!1,O.done(),O.remove()})},T=()=>{const t=new IntersectionObserver(e=>{e[0].isIntersecting&&n()});ce(()=>{t.observe($.value)})};return X(S,Y.exports.debounce(()=>{k.value=1,n(!1)},300)),{activeTab:p,tabs:C,isLoaded:r,isDownloading:w,isDeleting:h,keyword:S,page:k,items:m,endlessPagination:$,selected:i,getMediaCrediting:J,downloadExternal:U,deletePermanently:K,removeItems:H,createObserver:T,toggleSelect:N,deselectAll:u,isSelected:I}},G={__name:"MediaSelectable",props:{active:{type:Boolean,default:!1}},emits:["click"],setup(c){return(b,_)=>(a(),y("div",{onClick:_[0]||(_[0]=D=>b.$emit("click")),class:"w-full relative cursor-pointer box-border"},[Z(b.$slots,"default"),g("div",{class:B(["absolute flex items-center justify-center top-0 right-0 mr-sm mt-sm w-7 h-7 rounded-full border border-white",{"bg-primary-500":c.active,"bg-black bg-opacity-20":!c.active}])},[c.active?(a(),M(de,{key:0,class:"text-white"})):f("",!0)],2)]))}},_e=["onDrop"],he={class:"relative flex flex-col justify-center"},ke={class:"text-center mb-1"},ye={for:"browse",class:"cursor-pointer text-primary-500 hover:text-primary-700 active:text-primary-700 focus:outline-none focus:text-primary-700 transition-colors ease-in-out duration-200"},be={class:"text-sm text-gray-400 text-center"},xe=["accept"],we={key:0,class:"mt-lg"},$e={__name:"UploadMedia",props:{maxSelection:{type:Number,default:1},combinesMimeTypes:{type:String,default:""},selected:{type:Array,default:[]},toggleSelect:{type:Function},isSelected:{type:Function},columns:{type:Number,default:3}},emits:["mediaSelect"],setup(c,{emit:b}){const _=c,D=z("workspaceCtx"),p=F().props.mixpost.mime_types,C=v(null),r=v(!1),w=t=>{if(m.value)return;r.value=!1;const e=k(t.dataTransfer.files);e.length&&J(e)},h=t=>{const e=k(t.target.files);e.length&&(C.value.value=null,J(e))},k=t=>Array.from(t).filter(e=>p.includes(e.type)),m=v(!1),$=v([]),S=v([]),i=v({});X(i,()=>{N(),m.value=Object.keys(i.value).length>0});const N=()=>{i.value.handler&&i.value.handler()},u=t=>{$.value.push(t),Object.keys(i.value).length===0&&I()},I=t=>{Object.keys(i.value).length>0&&(H(i.value,t),_.toggleSelect&&_.toggleSelect(t)),$.value.length>0?(n($.value[0]),U()):n({})},n=t=>{i.value=t},U=()=>{$.value.shift()},H=(t,e)=>{S.value.push(Object.assign(t,{media:e}))},J=t=>{t.forEach(e=>{u({id:ve(),handler:async()=>{await K(e).then(l=>{I(l)}).catch(l=>{I({name:e.name,error:l.response.data.message})})}})})},K=t=>{const e=new FormData;return e.append("file",t),new Promise((l,W)=>{axios.post(route("mixpost.media.upload",{workspace:D.id}),e).then(function(q){l(q.data)}).catch(function(q){W(q)})})},T=A(()=>S.value.filter(()=>!0).reverse());return v([]),(t,e)=>(a(),y(P,null,[g("div",{onDragenter:e[2]||(e[2]=V(l=>r.value=!m.value,["prevent"])),onDrop:V(w,["prevent"]),onDragover:e[3]||(e[3]=V(()=>{},["prevent"])),class:B([{"border-gray-700 bg-white":!r.value,"border-cyan-500 bg-cyan-50":r.value},"relative w-full flex items-center justify-center rounded-lg p-10 border-2 border-dashed transition-colors ease-in-out duration-200"])},[g("div",he,[r.value?(a(),y("div",{key:0,onDragleave:e[0]||(e[0]=V(l=>r.value=!1,["prevent"])),onDragover:e[1]||(e[1]=V(()=>{},["prevent"])),class:"w-full h-full absolute"},null,32)):f("",!0),d(me,{class:B([{"text-stone-700":!r.value,"text-cyan-500":r.value},"!w-16 !h-16 mx-auto mb-xs transition-colors ease-in-out duration-200"])},null,8,["class"]),g("div",ke,[j(x(t.$t("media.drag_drop_files"))+" ",1),g("label",ye,x(t.$t("general.browse")),1)]),g("div",be,x(s(p).join(", ")),1)]),m.value?(a(),M(fe,{key:0,size:"xl",class:"rounded-lg"})):f("",!0)],42,_e),g("input",{ref_key:"input",ref:C,id:"browse",type:"file",accept:s(p).join(","),multiple:"multiple",class:"hidden",onChange:h},null,40,xe),s(T).length?(a(),y("div",we,[d(E,{items:s(T),columns:c.columns},{default:o(({item:l})=>[d(G,{active:c.isSelected(l.media),onClick:W=>c.toggleSelect(l.media)},{default:o(()=>[d(L,{media:l.media},null,8,["media"])]),_:2},1032,["active","onClick"])]),_:1},8,["items","columns"])])):f("",!0)],64))}},Le={__name:"MediaUploads",props:{columns:{type:Number,default:3}},setup(c,{expose:b}){const _=z("workspaceCtx"),{page:D,items:p,endlessPagination:C,selected:r,toggleSelect:w,deselectAll:h,removeItems:k,isSelected:m,createObserver:$}=R("mixpost.media.fetchUploads",{workspace:_.id});return Q(()=>{$()}),b({selected:r,deselectAll:h,removeItems:k}),(S,i)=>(a(),y(P,null,[d($e,{"max-selection":4,"combines-mime-types":"",selected:s(r),toggleSelect:s(w),isSelected:s(m),columns:c.columns},null,8,["selected","toggleSelect","isSelected","columns"]),g("div",{class:B({"mt-lg":s(p).length})},[s(p).length?(a(),y(P,{key:0},[d(ge,{class:"mb-4"},{default:o(()=>[j(x(S.$t("media.library")),1)]),_:1}),d(E,{items:s(p),columns:c.columns},{default:o(({item:N})=>[N?(a(),M(G,{key:0,active:s(m)(N),onClick:u=>s(w)(N)},{default:o(()=>[d(L,{media:N},null,8,["media"])]),_:2},1032,["active","onClick"])):f("",!0)]),_:1},8,["items","columns"])],64)):f("",!0),g("div",{ref_key:"endlessPagination",ref:C,class:"-z-10 w-full"},null,512)],2)],64))}},Ce={},Se={class:"absolute z-10 bottom-0 mb-xs left-0 ml-xs hidden group-hover:block shadow-mix"},Ne={class:"bg-white shadow-mix py-xs px-sm text-left rounded-md"};function De(c,b){return a(),y("div",Se,[g("div",Ne,[Z(c.$slots,"default")])])}const re=pe(Ce,[["render",De]]),Ie={key:0},je={key:0,class:"mt-lg"},Me=["href"],Oe=["href"],Ge={__name:"MediaStock",props:{columns:{type:Number,default:3}},setup(c,{expose:b}){const _=z("workspaceCtx"),{user:D}=ee(),p=A(()=>Y.exports.snakeCase(F().props.app.name)),C=A(()=>F().props.is_configured_service.unsplash),{isLoaded:r,keyword:w,items:h,endlessPagination:k,selected:m,toggleSelect:$,deselectAll:S,isSelected:i,createObserver:N}=R("mixpost.media.fetchStock",{workspace:_.id});return Q(()=>{C.value&&N()}),b({selected:m,deselectAll:S}),(u,I)=>(a(),y(P,null,[s(C)?(a(),y("div",Ie,[d(le,{modelValue:s(w),"onUpdate:modelValue":I[0]||(I[0]=n=>te(w)?w.value=n:null),placeholder:u.$t("service.unsplash.search")},null,8,["modelValue","placeholder"]),s(h).length?(a(),y("div",je,[d(E,{items:s(h),columns:c.columns},{default:o(({item:n})=>[n?(a(),M(G,{key:0,active:s(i)(n),onClick:U=>s($)(n)},{default:o(()=>[d(L,{media:n,class:"group"},{default:o(()=>[d(re,null,{default:o(()=>[g("div",null,[j(x(u.$t("media.image_source"))+": ",1),g("a",{href:`https://unsplash.com/?utm_source=${s(p)}&utm_medium=referral`,target:"_blank",class:"link"},"Unsplash",8,Me)]),g("div",null,[j(x(u.$t("media.author"))+": ",1),g("a",{href:`${n.credit_url}?utm_source=${s(p)}&utm_medium=referral`,target:"_blank",class:"link"},x(n.name),9,Oe)])]),_:2},1024)]),_:2},1032,["media"])]),_:2},1032,["active","onClick"])):f("",!0)]),_:1},8,["items","columns"])])):f("",!0),s(r)&&!s(h).length?(a(),M(ne,{key:1,class:"mt-lg"},{default:o(()=>[j(x(u.$t("media.no_images_found")),1)]),_:1})):f("",!0),g("div",{ref_key:"endlessPagination",ref:k,class:"-z-10 w-full"},null,512)])):f("",!0),s(C)?f("",!0):(a(),y(P,{key:1},[d(oe,{variant:"warning",closeable:!1},{default:o(()=>[j(x(u.$t("service.not_configured_service",{service:"Unsplash"})),1)]),_:1}),s(D).is_admin?(a(),M(s(ae),{key:0,href:u.route("mixpost.services.index"),class:"block mt-md"},{default:o(()=>[d(se,null,{default:o(()=>[j(x(u.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):f("",!0)],64))],64))}},Pe={key:0},Ue={key:0,class:"mt-lg"},He={__name:"MediaGifs",props:{columns:{type:Number,default:3}},setup(c,{expose:b}){const _=z("workspaceCtx"),{user:D}=ee(),p=A(()=>F().props.is_configured_service.tenor),{isLoaded:C,keyword:r,page:w,items:h,endlessPagination:k,selected:m,toggleSelect:$,deselectAll:S,isSelected:i,createObserver:N}=R("mixpost.media.fetchGifs",{workspace:_.id});return Q(()=>{p.value&&N()}),b({selected:m,deselectAll:S}),(u,I)=>(a(),y(P,null,[s(p)?(a(),y("div",Pe,[d(le,{modelValue:s(r),"onUpdate:modelValue":I[0]||(I[0]=n=>te(r)?r.value=n:null),placeholder:u.$t("service.tenor.search_gifs")},null,8,["modelValue","placeholder"]),s(h).length?(a(),y("div",Ue,[d(E,{items:s(h),columns:c.columns},{default:o(({item:n})=>[n?(a(),M(G,{key:0,active:s(i)(n),onClick:U=>s($)(n)},{default:o(()=>[(a(),M(L,{media:n,key:n.id,class:"group"},{default:o(()=>[d(re,null,{default:o(()=>[j(x(u.$t("service.tenor.gif")),1)]),_:1})]),_:2},1032,["media"]))]),_:2},1032,["active","onClick"])):f("",!0)]),_:1},8,["items","columns"])])):f("",!0),s(C)&&!s(h).length?(a(),M(ne,{key:1,class:"mt-lg"},{default:o(()=>[j(x(u.$t("media.no_gifs_found")),1)]),_:1})):f("",!0),g("div",{ref_key:"endlessPagination",ref:k,class:"-z-10 w-full"},null,512)])):f("",!0),s(p)?f("",!0):(a(),y(P,{key:1},[d(oe,{variant:"warning",closeable:!1},{default:o(()=>[j(x(u.$t("service.not_configured_service",{service:"Tenor"})),1)]),_:1}),s(D).is_admin?(a(),M(s(ae),{key:0,href:u.route("mixpost.services.index"),class:"block mt-md"},{default:o(()=>[d(se,null,{default:o(()=>[j(x(u.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):f("",!0)],64))],64))}};export{Le as _,Ge as a,He as b,R as u};
